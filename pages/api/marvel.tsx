const staticData = [
    {
        id: 100213,
        title: "Hulk Vs. Thor: Banner Of War  (Trade Paperback)",
        issueNumber: 0,
        publishDate: "2022-10-19T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12712",
                name: "Donny Cates",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14143",
                name: "Nadia Shammas",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14285",
                name: "Martin Coccolo",
                role: "penciller",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4989",
                name: "Nic Klein",
                role: "penciller",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/308",
                name: "Gary Frank",
                role: "penciller (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4430",
                name: "Jeff Youngquist",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/9/b0/634d57a98bda4.jpg",
    },
    {
        id: 95773,
        title: "Avengers Forever (2021) #8",
        issueNumber: 8,
        publishDate: "2022-08-24T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Captain America",
                id: 1009220,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11463",
                name: "Jason Aaron",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/2133",
                name: "Tom Brevoort",
                role: "editor",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12239",
                name: "Guru Efx",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/426",
                name: "Jason Keith",
                role: "colorist (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12979",
                name: "Aaron Kuder",
                role: "penciler (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12980",
                name: "Vc Cory Petit",
                role: "letterer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/480",
                name: "Cam Smith",
                role: "inker",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/c/f0/630507910522f.jpg",
    },
    {
        id: 99641,
        title: "Avengers 1,000,000 BC (2022) #1",
        issueNumber: 1,
        publishDate: "2022-08-17T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Gamora",
                id: 1010763,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11463",
                name: "Jason Aaron",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/2133",
                name: "Tom Brevoort",
                role: "editor",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/649",
                name: "Ed Mcguinness",
                role: "penciler (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12980",
                name: "Vc Cory Petit",
                role: "letterer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/234",
                name: "Kev Walker",
                role: "inker",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/442",
                name: "Dean White",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/10279",
                name: "Matthew Wilson",
                role: "colorist (cover)",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/9/70/62f3c6a4b53d9.jpg",
    },
    {
        id: 103360,
        title: "Avengers Unlimited Infinity Comic (2022) #6",
        issueNumber: 6,
        publishDate: "2022-08-09T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Gamora",
                id: 1010763,
            },
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Captain America",
                id: 1009220,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/2133",
                name: "Tom Brevoort",
                role: "editor",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14354",
                name: "Farid Karami",
                role: "penciller (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14319",
                name: "David Pepose",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/13449",
                name: "Chris Sotomayor",
                role: "colorist",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/9/50/62bf34456dee0.jpg",
    },
    {
        id: 89751,
        title: "Thor By Donny Cates Vol. 4: God Of Hammers (Trade Paperback)",
        issueNumber: 0,
        publishDate: "2022-07-27T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Gamora",
                id: 1010763,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12712",
                name: "Donny Cates",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4989",
                name: "Nic Klein",
                role: "penciller (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4430",
                name: "Jeff Youngquist",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/c/20/62dac5ca5d357.jpg",
    },
    {
        id: 92201,
        title: "Avengers (2018) #57",
        issueNumber: 57,
        publishDate: "2022-07-13T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Gamora",
                id: 1010763,
            },
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Captain America",
                id: 1009220,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
            {
                name: "Black Widow",
                id: 1009189,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11463",
                name: "Jason Aaron",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/2133",
                name: "Tom Brevoort",
                role: "editor",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/13021",
                name: "David Curiel",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12426",
                name: "Javier Garron",
                role: "penciler (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12980",
                name: "Vc Cory Petit",
                role: "letterer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14265",
                name: "Alex Sinclair",
                role: "colorist (cover)",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/6/a0/62b9e0de53718.jpg",
    },
    {
        id: 103356,
        title: "Avengers Unlimited Infinity Comic (2022) #2",
        issueNumber: 2,
        publishDate: "2022-07-12T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Gamora",
                id: 1010763,
            },
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Captain America",
                id: 1009220,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
            {
                name: "Black Widow",
                id: 1009189,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14430",
                name: "Dc Alonso",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/2133",
                name: "Tom Brevoort",
                role: "editor",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14319",
                name: "David Pepose",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12644",
                name: "Alan Robinson",
                role: "penciller (cover)",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/7/80/629f7ff23856e.jpg",
    },
    {
        id: 100379,
        title: "Jane Foster & the Mighty Thor (2022) #2",
        issueNumber: 2,
        publishDate: "2022-07-06T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Black Widow",
                id: 1009189,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11482",
                name: "Jesus Aburtov",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/13651",
                name: "Michael Dowling",
                role: "inker",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/13250",
                name: "Romulo Fajardo Jr.",
                role: "colorist (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14017",
                name: "Torunn Gronbekk",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/13260",
                name: "Jp Mayer",
                role: "inker (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12376",
                name: "Wilson Moss",
                role: "editor",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12974",
                name: "Vc Joe Sabino",
                role: "letterer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/1156",
                name: "Ryan Stegman",
                role: "penciler (cover)",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/3/30/62b9e0725e403.jpg",
    },
    {
        id: 105643,
        title: "Strange Tales: Thor & Jane Foster Infinity Comic (2022) #1",
        issueNumber: 1,
        publishDate: "2022-07-06T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12741",
                name: "Ramon Bachs",
                role: "penciller (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/13586",
                name: "Joe Caramagna",
                role: "letterer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/9550",
                name: "Tim Seeley",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/8704",
                name: "Javier Tartaglia",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/14311",
                name: "Jordan White",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/c/70/62a1f4c5c8ce7.jpg",
    },
    {
        id: 102424,
        title: "Thor: The Saga Of Gorr The God Butcher (Trade Paperback)",
        issueNumber: 0,
        publishDate: "2022-06-29T00:00:00-0400",
        characters: [
            {
                name: "Thor",
                id: 1009664,
            },
            {
                name: "Gamora",
                id: 1010763,
            },
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Captain America",
                id: 1009220,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
            {
                name: "Black Widow",
                id: 1009189,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11463",
                name: "Jason Aaron",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/2697",
                name: "Butch Guice",
                role: "penciller",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/182",
                name: "Esad Ribic",
                role: "penciller (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4430",
                name: "Jeff Youngquist",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/6/30/62b5f83107a6c.jpg",
    },
    {
        id: 101198,
        title: "Thor: Lightning and Lament (2022) #1",
        issueNumber: 1,
        publishDate: "2022-06-29T00:00:00-0400",
        characters: [
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Deadpool",
                id: 1009268,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
            {
                name: "Wasp",
                id: 1009707,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/658",
                name: "Ron Lim",
                role: "penciler (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/1282",
                name: "Ralph Macchio",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/935",
                name: "Todd Nauck",
                role: "inker",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12991",
                name: "Rachelle Rosenberg",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/12974",
                name: "Vc Joe Sabino",
                role: "letterer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/13052",
                name: "Israel Silva",
                role: "colorist (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/13046",
                name: "Alanna Smith",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/c/20/62b9e0abe47c3.jpg",
    },
    {
        id: 100174,
        title: "Thor: God of Thunder - The God Butcher Infinity Comic (2022) #3",
        issueNumber: 3,
        publishDate: "2022-06-21T00:00:00-0400",
        characters: [
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Deadpool",
                id: 1009268,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
            {
                name: "Wasp",
                id: 1009707,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11463",
                name: "Jason Aaron",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/182",
                name: "Esad Ribic",
                role: "penciller (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/8775",
                name: "Joe Sabino",
                role: "letterer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11561",
                name: "Ive Svorcina",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4430",
                name: "Jeff Youngquist",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/7/60/6287bd87e66a7.jpg",
    },
    {
        id: 100176,
        title: "Thor: God of Thunder - The God Butcher Infinity Comic (2022) #5",
        issueNumber: 5,
        publishDate: "2022-06-21T00:00:00-0400",
        characters: [
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Deadpool",
                id: 1009268,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
            {
                name: "Wasp",
                id: 1009707,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4430",
                name: "Jeff Youngquist",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/c/e0/6287bd87ecc3c.jpg",
    },
    {
        id: 100178,
        title: "Thor: God of Thunder - The God Butcher Infinity Comic (2022) #7",
        issueNumber: 7,
        publishDate: "2022-06-21T00:00:00-0400",
        characters: [
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Deadpool",
                id: 1009268,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
            {
                name: "Wasp",
                id: 1009707,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4430",
                name: "Jeff Youngquist",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/c/90/6287bd9adce23.jpg",
    },
    {
        id: 100173,
        title: "Thor: God of Thunder - The God Butcher Infinity Comic (2022) #2",
        issueNumber: 2,
        publishDate: "2022-06-21T00:00:00-0400",
        characters: [
            {
                name: "Iron Man",
                id: 1009368,
            },
            {
                name: "Deadpool",
                id: 1009268,
            },
            {
                name: "Scarlet Witch",
                id: 1009562,
            },
            {
                name: "Wasp",
                id: 1009707,
            },
        ],
        creators: [
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11463",
                name: "Jason Aaron",
                role: "writer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/182",
                name: "Esad Ribic",
                role: "penciller (cover)",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/8775",
                name: "Joe Sabino",
                role: "letterer",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/11561",
                name: "Ive Svorcina",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/442",
                name: "Dean White",
                role: "colorist",
            },
            {
                resourceURI: "http://gateway.marvel.com/v1/public/creators/4430",
                name: "Jeff Youngquist",
                role: "editor",
            },
        ],
        thumbnail: "http://i.annihil.us/u/prod/marvel/i/mg/c/c0/6287bd87eafb1.jpg",
    },
];

export default async function getData(req: any, res: any) {
    const md5 = require("js-md5");
    const timestamp = Date.now();
    const hash = md5(
        `${timestamp}${process.env.NEXT_PUBLIC_MARVEL_PRIVATE_KEY}${process.env.NEXT_PUBLIC_MARVEL_PUBLIC_KEY}`,
    );
    const dataLimit = 15;
    let api = `https://gateway.marvel.com/v1/public/comics?ts=${timestamp}&apikey=${process.env.NEXT_PUBLIC_MARVEL_PUBLIC_KEY}&hash=${hash}&limit=${dataLimit}`;
    let apiFilters = "";
    let filters;
    let response;
    let data;
    let returnData;

    // res.status(200).json({
    //     data: staticData,
    // });

    if (req.query.filters) {
        filters = JSON.parse(req.query.filters);

        if (filters.characters) {
            apiFilters += `&characters=${filters.characters}`;
        }

        if (filters.creators) {
            apiFilters += `&creators=${filters.creators}`;
        }
    }

    if (req.query.page) {
        apiFilters += `&offset=${Number(req.query.page) * dataLimit}`;
    }

    response = await fetch(`${api}${apiFilters}`);

    if (!response.ok) {
        res.status(response.status).json({
            message: response.statusText,
        });

        console.log(`${response.status} ${response.statusText}`);
    } else {
        data = await response.json();

        returnData = data.data.results.map((result: any) => {
            return {
                id: result.id,
                title: result.title,
                thumbnail: `${result.thumbnail.path}.${result.thumbnail.extension}`,
                issueNumber: result.issueNumber,
                publishDate: result.dates.find((d: any) => d.type === "onsaleDate").date,
                creators: result.creators.items,
            };
        });

        res.status(200).json({
            data: returnData,
            total: data.data.total,
        });
    }
}
